<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="indexCSS " href="test.css">

    <style>
        * {
            margin: 0;
            padding: 0;
        }

        body {
            /* background-color: gainsboro; */
        }

        /* list 영역 */
        #root {
            display: flex;

        }

        #list {
            display: flex;
            flex-direction: column;
            background-color: dimgray;
            width: 40vw;
            height: 100vh;
        }


        #result {
            margin: 10px;
            width: 50vw;
            height: 50vh;
            border: 1px solid black;
            background-color: white;
        }

        #result {
            overflow: scroll;

        }

        #menu {
            border: 1px solid black;
            display: flex;
            flex-direction: column;
            width: 25px;
            height: auto;

        }

        #m1 {
            border: 1px solid grey;
            background-color: black;
            width: 20px;
            height: 3px;
            margin: 0.5px;
        }



        /* chat 영역 */
    </style>
</head>

<body>
    <form action="/text" method="post">

        <!-- 최상위 id -->
        <div id="root">
            <!-- 왼쪽 목록 및 로그인 정보  -->
            <div id="list">
                <div id="menu">
                    <div id="m1"></div>
                    <div id="m1"></div>
                    <div id="m1"></div>
                </div>


                <!-- 메시지 title -->
                <ul id="title">
                    내용 없음
                    <!-- 사용자가 입력했던 메시지 title -->
                </ul>
                <!-- 로그인 정보 -->
                <div id="info">
                    신동현 <br>
                    <img src="" alt="프로필 사진">
                </div>
            </div>

            <!-- 메시지 영역 -->
            <div id="chatArea" name="chatArea">
                <!-- 메시지 입력 결과 -->
                <div id="result">

                </div>
                <!-- 메시지 입력 화면 -->
                <label for="chat">메시지 입력</label>
                <input id="chat" type="text" name="chat" value="메시지 입력">
                <input id="send" type="button" name="send" value="입력">
            </div>
        </div>


    </form>



    <script>
        // 구현된 과제
        // 1. 서버(app.js)에서페이지(index.html)을 표시하는 응답을 전달(index.html)
        // 2. 페이지(index.html)에서 메시지를 입력 했을 때 action: index.html전달과 mothod : post 방식으로 서버에 전달


        // 남은과제    
        // 1. index.html에서 메시지를 입력했을 때 app.js로 받는 방식(express, post 방식);
        // 메시지 입력 후 reslut에 표시되는게 아니라 서버(app.js)쪽에 json 형식으로 전달 되는지 확인

        // 2. app.js에서 json으로 변환 후 형식에 맞게 데이터가 계속 추가되는 과정
        // 서버(app.js)에서 body 데이터를 받고 파싱하는 과정확인

        // 3. data.json에서 (유저명), (메시지), (시간) 등이 형식에 맞게 잘 저장되는지 확인
        // 서버에서 파싱된 데이터가 어떻게 저장되는지 확인

        // 4. data.json에서 (유저명), (메시지), (시간) 등이 저장되어있는데 다시 서버로 전달하는지 확인
        // data.js에서 받은 데이터가 서버에서 어떤 처리로 다시 index.html로 넘겨주는지 확인

        // 5. app.js에서 다시 index.html(express, post 방식)으로 데이터 전달 후 출력 되는지 확인
        // 적제 적소로 데이터가 잘 표시되는지 확인


        const result = document.getElementById("result");
        const chat = document.getElementById("chat");
        const send = document.getElementById("send");

        // 입력한 데이터를 data.json으로 key의 맞춰 전송

        send.addEventListener("click", function (event) {
            if (chat.value === "") {
                alert("내용을 입력해주세요!");
                chat.focus();
            } else {
                const message = chat.value;
                const timestamp = new Date().toLocaleTimeString();
                const chatData = {
                    type: "user",
                    message: message,
                    timestamp: timestamp
                };

                // 전달되는 데이터 확인용
                // console.log("메시지 전송 확인 message", message);
                // console.log("메시지 전송 확인 time", timestamp);
                // console.log("메시지 전송 확인 chatData", chatData);


                // JSON 데이터를 서버로 전송
                fetch("/text", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(chatData)
                })
                    .then(response => response.json())
                    .then(data => {
                        // 서버에서 전달된 응답 처리 (필요하면)
                        console.log(data);


                    });

                const li = document.createElement("li");
                li.textContent = chat.value + message ;
                result.appendChild(li);
                chat.value = "";
                chat.focus();




            }


            // html 메시지를 표시하기위한 코드
            function appendMessage(type, message, timestamp) {
                li.textContent = message;
                result.appendChild(li);

                console.log(message);
            }

        });






    </script>


</body>

</html>